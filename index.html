<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; connect-src 'self';">
<title>Starry Quiz TTS</title>
<style>
  :root {
    --bg-deep: #050a15;
    --nebula-1: #0d1b33;
    --nebula-2: #1a0b2e;
    --panel: rgba(15, 25, 45, 0.7);
    --panel-border: rgba(255, 255, 255, 0.1);
    --text: #e2e8f0;
    --muted: #94a3b8;
    --accent: #7dd3fc;
    --accent-glow: rgba(125, 211, 252, 0.4);
    --success: #6ee7b7;
    --danger: #fda4af;
  }

  * { box-sizing: border-box; }

  /* èƒŒæ™¯ï¼ˆæš—ã„é’ï¼‹ãƒãƒ“ãƒ¥ãƒ©ï¼‰ */
  body {
    margin: 0;
    font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
    background: radial-gradient(circle at center, #001529 0%, #000814 100%);
    background-image:
      radial-gradient(circle at 20% 30%, var(--nebula-2) 0%, transparent 40%),
      radial-gradient(circle at 80% 70%, var(--nebula-1) 0%, transparent 40%);
    color: var(--text);
    min-height: 100vh;
    overflow-x: hidden;
    position: relative;
  }

  /* â˜…æ˜Ÿã®ã¾ãŸãŸãï¼ˆæ—§ body::beforeï¼‰ã¯å‰Šé™¤ã—ã¦ã€éŸ³ç¬¦èƒŒæ™¯ã«ç½®ãæ›ãˆ */
  #bg-notes {
    position: fixed;
    inset: 0;
    overflow: hidden;
    pointer-events: none;
    z-index: -1; /* ç”»é¢ã®ä¸€ç•ªå¥¥ */
  }

  .floating-note {
    position: absolute;
    bottom: -60px;
    left: 0;
    color: #e6f6ff; /* é’ç™½ã„æ°·å…‰ */
    user-select: none;
    pointer-events: none;
    text-shadow:
      0 0 6px #e6f6ff,
      0 0 14px #bfe9ff,
      0 0 24px rgba(191, 233, 255, 0.6);
    filter: drop-shadow(0 0 6px rgba(191, 233, 255, 0.45));
    will-change: transform, opacity;
    animation: noteRise linear forwards;
  }

  /* ä¸‹ã‹ã‚‰æ¹§ãâ†’ä¸Šã§æ³¡ã£ã½ãå¼¾ã‘ã‚‹ */
  @keyframes noteRise {
    0%   { transform: translate3d(0, 0, 0) scale(0.9) rotate(0deg); opacity: 0; }
    10%  { opacity: 0.75; }
    70%  { opacity: 0.75; }
    85%  { transform: translate3d(var(--drift, 0px), -78vh, 0) scale(1.15) rotate(18deg); opacity: 0.7; }
    100% { transform: translate3d(calc(var(--drift, 0px) * 1.2), -92vh, 0) scale(2.35) rotate(26deg); opacity: 0; }
  }

  header {
    backdrop-filter: blur(12px);
    background: rgba(5, 10, 21, 0.8);
    border-bottom: 1px solid var(--panel-border);
    padding: 20px;
    text-align: center;
    position: sticky;
    top: 0;
    z-index: 100;
  }

  header h1 {
    margin: 0;
    font-weight: 300;
    letter-spacing: 4px;
    text-transform: uppercase;
    font-size: 1.4rem;
    color: var(--accent);
    text-shadow: 0 0 15px var(--accent-glow);
  }

  .wrap {
    max-width: 900px;
    margin: 0 auto;
    padding: 20px;
    display: grid;
    gap: 20px;
  }

  .card {
    background: var(--panel);
    backdrop-filter: blur(10px);
    border: 1px solid var(--panel-border);
    border-radius: 20px;
    padding: 24px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
  }

  h3 {
    margin-top: 0;
    font-size: 0.9rem;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 1px;
    border-left: 3px solid var(--accent);
    padding-left: 10px;
    margin-bottom: 20px;
  }

  .row { display: flex; gap: 12px; flex-wrap: wrap; align-items: center; }
  .grid-settings {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    gap: 15px;
  }

  .field { display: flex; flex-direction: column; gap: 6px; }
  label { font-size: 11px; color: var(--muted); font-weight: 600; }

  input, select {
    background: rgba(0, 0, 0, 0.3);
    color: var(--text);
    border: 1px solid var(--panel-border);
    border-radius: 8px;
    padding: 10px;
    font-size: 14px;
    transition: all 0.3s;
  }

  input:focus, select:focus, textarea:focus {
    border-color: var(--accent);
    box-shadow: 0 0 8px var(--accent-glow);
    outline: none;
  }

  button {
    background: rgba(255, 255, 255, 0.05);
    color: var(--text);
    border: 1px solid var(--panel-border);
    border-radius: 10px;
    padding: 10px 18px;
    cursor: pointer;
    font-size: 14px;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  button:hover { background: rgba(255, 255, 255, 0.15); transform: translateY(-1px); }
  button.primary { background: var(--accent); color: #050a15; font-weight: bold; border: none; }
  button.primary:hover { background: #bae6fd; box-shadow: 0 0 15px var(--accent-glow); }
  button.success { border-color: var(--success); color: var(--success); }

  progress {
    width: 100%;
    height: 6px;
    border-radius: 10px;
    overflow: hidden;
    appearance: none;
  }
  progress::-webkit-progress-bar { background: rgba(255,255,255,0.1); }
  progress::-webkit-progress-value {
    background: linear-gradient(90deg, var(--accent), var(--success));
    box-shadow: 0 0 10px var(--accent-glow);
  }

  .list {
    margin-top: 10px;
    max-height: 400px;
    overflow-y: auto;
    scrollbar-width: thin;
    scrollbar-color: var(--panel-border) transparent;
  }

  .item {
    display: flex;
    justify-content: space-between;
    padding: 15px;
    border-bottom: 1px solid var(--panel-border);
    transition: 0.3s;
    border-radius: 10px;
    margin-bottom: 4px;
  }
  .item:hover { background: rgba(255, 255, 255, 0.03); }
  .item.active {
    background: rgba(125, 211, 252, 0.1);
    border: 1px solid var(--accent);
  }

  .q { font-weight: 500; color: #fff; margin-bottom: 4px; }
  .a { color: var(--accent); font-size: 0.95rem; animation: fadeIn 0.5s ease; }

  @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

  .kbd {
    background: rgba(255,255,255,0.1);
    padding: 2px 6px;
    border-radius: 4px;
    font-size: 10px;
    border: 1px solid rgba(255,255,255,0.2);
  }

  #status { font-size: 13px; margin: 10px 0; color: var(--accent); }

  /* =========================
     âœ… ã‚¹ãƒãƒ›æœ€é©åŒ–ï¼ˆæ–‡å­—ãŒå°ã•ã„å•é¡Œã®æ ¹æ²»ï¼‰
     ç›®çš„ï¼š16pxæœªæº€ã‚’æ¶ˆã™ / ã‚¿ãƒƒãƒ—é ˜åŸŸã‚’ç¢ºä¿ / å…¥åŠ›ã‚’èª­ã¿ã‚„ã™ã
     ========================= */
  @media (max-width: 600px) {

    /* ä½™ç™½ã‚’å°‘ã—è©°ã‚ã¦â€œæ‹¡å¤§ã—ãªãã¦ã‚‚èª­ã‚ã‚‹å¯†åº¦â€ã¸ */
    header { padding: 14px 12px; }
    header h1 {
      font-size: 1.6rem;
      letter-spacing: 2px;
    }

    .wrap { padding: 12px; gap: 14px; }
    .card { padding: 16px; border-radius: 18px; }

    /* å…¥åŠ›ã‚¨ãƒªã‚¢ã¯2åˆ—å›ºå®šã ã¨ç‹­ã„ï¼š1åˆ—ãŒæ­£ç¾© */
    .grid-settings { grid-template-columns: 1fr; }

    /* æ–‡å­—ã‚µã‚¤ã‚ºï¼šiOSã®ã‚ºãƒ¼ãƒ ç™ºå‹•ï¼ˆ16pxæœªæº€ï¼‰ã‚’æ ¹çµ¶ */
    body { font-size: 16px; }

    label { font-size: 13px; }

    input, select, textarea, button {
      font-size: 16px;
      line-height: 1.25;
    }

    /* textarea ã¯ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã§ 13px æŒ‡å®šã•ã‚Œã¦ã‚‹ã®ã§ä¸Šæ›¸ã */
    #directInput { font-size: 16px !important; }

    /* ã‚¿ãƒƒãƒ—é ˜åŸŸï¼šæœ€ä½44pxï¼ˆæŒ‡ã¯ãƒã‚¦ã‚¹ã˜ã‚ƒãªã„ï¼‰ */
    button { padding: 14px 16px; min-height: 44px; }
    input, select, textarea { padding: 12px; }

    /* ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«è¡Œã¯ç¸¦ç©ã¿ã§æŠ¼ã—ã‚„ã™ã */
    .row { gap: 10px; }

    /* â€œæ“ä½œãƒœã‚¿ãƒ³è¡Œâ€ã ã‘ç¸¦ç©ã¿ï¼ˆä»–ã®rowã¯å´©ã•ãªã„ï¼‰ */
    #startBtn, #pauseBtn, #stopBtn, #prevBtn, #nextBtn { width: 100%; justify-content: center; }

    /* ã‚­ãƒ¼ãƒ’ãƒ³ãƒˆã¯ã‚¹ãƒãƒ›ã§ã¯å°ã•ã™ãï¼†å¿…è¦åº¦ä½ã„ã®ã§æ§ãˆã‚ã« */
    .kbd { font-size: 11px; }
    #status { font-size: 14px; }

    /* é‡ã„ç«¯æœ«å¯¾ç­–ï¼šãƒ–ãƒ©ãƒ¼ã‚’å°‘ã—è»½é‡åŒ–ï¼ˆé›°å›²æ°—ã¯ä¿ã¤ï¼‰ */
    header { backdrop-filter: blur(8px); }
    .card { backdrop-filter: blur(8px); }
  }
</style>
</head>
<body>

<!-- èƒŒæ™¯ï¼šéŸ³ç¬¦ãƒ¬ã‚¤ãƒ¤ãƒ¼ -->
<div id="bg-notes" aria-hidden="true"></div>

<header>
  <h1>Starry Quiz TTS</h1>
</header>

<main class="wrap">
  <section class="card">
    <h3><i class="icon">âœ§</i> configuration</h3>
    <div class="grid-settings">
      <div class="field"><label>JSON / TXT èª­è¾¼</label><input id="topImportFile" type="file" accept="application/json,text/plain,.json,.txt"></div>
      <div class="field"><label>ãƒªãƒ”ãƒ¼ãƒˆ</label><input id="repeatQ" type="number" value="1"></div>
      <div class="field"><label>è§£ç­”ã¾ã§(ç§’)</label><input id="delayA" type="number" value="3" step="0.5"></div>
      <div class="field"><label>è¨€èª</label>
        <select id="langHint">
          <option value="ja-JP" selected>æ—¥æœ¬èª</option>
          <option value="en-US">English (US)</option>
        </select>
      </div>
      <div class="field"><label>å£°</label><select id="voice"></select></div>
      <div class="field"><label>è§£ç­”è¡¨ç¤º</label>
        <select id="showAnswer">
          <option value="0">ã‚¯ã‚¤ã‚ºä¸­ã®ã¿è¡¨ç¤º</option>
          <option value="1">å¸¸ã«è¡¨ç¤º</option>
        </select>
      </div>
    </div>

    <!-- ç›´æ¥å…¥åŠ›ã‚¨ãƒªã‚¢ -->
    <div style="margin-top: 20px;">
      <div class="field">
        <label>ç›´æ¥å…¥åŠ›ï¼ˆ1è¡Œã«1å•ï¼šè³ªå•|ç­”ãˆï¼‰</label>
        <textarea id="directInput" rows="5" placeholder="ä¾‹ï¼š
å¤ªé™½ç³»ã§æœ€ã‚‚å¤§ãã„æƒ‘æ˜Ÿã¯ï¼Ÿ|æœ¨æ˜Ÿ
å…‰ãŒ1å¹´é–“ã«é€²ã‚€è·é›¢ã‚’ä½•ã¨ã„ã†ï¼Ÿ|å…‰å¹´
æœ€ã‚‚è¿‘ã„æ’æ˜Ÿã¯ï¼Ÿ|ãƒ—ãƒ­ã‚­ã‚·ãƒãƒ»ã‚±ãƒ³ã‚¿ã‚¦ãƒª" style="
          width: 100%;
          background: rgba(0,0,0,0.3);
          color: var(--text);
          border: 1px solid var(--panel-border);
          border-radius: 8px;
          padding: 10px;
          font-size: 13px;
          font-family: inherit;
          resize: vertical;
          transition: all 0.3s;
        "></textarea>
      </div>
      <div class="row" style="margin-top: 10px;">
        <button id="loadDirectBtn" class="primary">ğŸ“‹ å…¥åŠ›ã‹ã‚‰èª­è¾¼</button>
        <span style="font-size: 11px; color: var(--muted);">ã€Œè³ªå•|ç­”ãˆã€å½¢å¼ã§1è¡Œ1å•ã€‚åŒºåˆ‡ã‚Šã¯ | ã¾ãŸã¯ ã‚¿ãƒ–</span>
      </div>
    </div>

    <div class="row" style="margin-top: 20px;">
      <button id="clearBtn">ã‚¯ãƒªã‚¢</button>
      <div style="flex-grow: 1;"></div>
      <div class="field" style="flex-direction: row; align-items: center; gap: 10px;">
        <label>é€Ÿåº¦</label><input id="rate" type="number" value="1" step="0.1" style="width: 60px;">
        <label>éŸ³é‡</label><input id="vol" type="number" value="0.8" step="0.1" style="width: 60px;">
      </div>
    </div>
  </section>

  <section class="card">
    <div class="row" style="margin-bottom: 20px;">
      <button id="startBtn" class="primary">â–¶ PLAY START</button>
      <button id="pauseBtn">â¸ PAUSE / RESUME</button>
      <button id="stopBtn">â¹ STOP</button>
      <button id="prevBtn">â®</button>
      <button id="nextBtn">â­</button>
    </div>
    <progress id="prog" value="0" max="1"></progress>
    <div id="status">Ready to explore...</div>
    <div id="errorMsg" style="color:var(--danger); display:none; font-size:12px;"></div>
    <div id="successMsg" style="color:var(--success); display:none; font-size:12px;"></div>
  </section>

  <section class="card">
    <h3><i class="icon">âœ¦</i> question list</h3>
    <div id="list" class="list"></div>
    <div class="row" style="margin-top: 15px; font-size: 11px; color: var(--muted);">
      <span>âŒ¨ <span class="kbd">Space</span> å†ç”Ÿ/åœæ­¢</span>
      <span><span class="kbd">â†/â†’</span> å‰/æ¬¡</span>
      <span><span class="kbd">A</span> è¡¨ç¤ºåˆ‡æ›¿</span>
    </div>
  </section>
</main>

<script>
// --- [JavaScriptéƒ¨åˆ†ã¯å…ƒã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Œå…¨ç¶™æ‰¿ã€ä¸€éƒ¨UIæ›´æ–°ç”¨ã«é–¢æ•°ã®ã¿èª¿æ•´] ---
'use strict';


const EMBEDDED_DATA = {"version": 1, "items": [{"q": "ãƒ¡ãƒ«ãƒˆã§ä½¿ç”¨ã•ã‚ŒãŸéŸ³å£°ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ï¼Ÿ", "a": "åˆéŸ³ãƒŸã‚¯"}, {"q": "ç‚‰å¿ƒèè§£ã§ä½¿ç”¨ã•ã‚ŒãŸéŸ³å£°ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ï¼Ÿ", "a": "é¡éŸ³ãƒªãƒ³"}, {"q": "magnetã§ä½¿ç”¨ã•ã‚ŒãŸéŸ³å£°ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ï¼Ÿ", "a": "åˆéŸ³ãƒŸã‚¯ãƒ»å·¡éŸ³ãƒ«ã‚«"}, {"q": "Just Be Friendsã§ä½¿ç”¨ã•ã‚ŒãŸéŸ³å£°ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ï¼Ÿ", "a": "å·¡éŸ³ãƒ«ã‚«"}, {"q": "æ‚ªãƒå¨˜ã§ä½¿ç”¨ã•ã‚ŒãŸéŸ³å£°ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ï¼Ÿ", "a": "é¡éŸ³ãƒªãƒ³"}, {"q": "æ‚ªãƒå¬ä½¿ã§ä½¿ç”¨ã•ã‚ŒãŸéŸ³å£°ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ï¼Ÿ", "a": "é¡éŸ³ãƒ¬ãƒ³"}, {"q": "å¤©ãƒå¼±ã§ä½¿ç”¨ã•ã‚ŒãŸéŸ³å£°ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ï¼Ÿ", "a": "GUMI"}, {"q": "ãƒ¢ã‚¶ã‚¤ã‚¯ãƒ­ãƒ¼ãƒ«ã§ä½¿ç”¨ã•ã‚ŒãŸéŸ³å£°ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ï¼Ÿ", "a": "GUMI"}, {"q": "å…­å…†å¹´ã¨ä¸€å¤œç‰©èªã§ä½¿ç”¨ã•ã‚ŒãŸéŸ³å£°ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ï¼Ÿ", "a": "IA"}, {"q": "ãƒ­ã‚¹ãƒˆãƒ¯ãƒ³ã®å·å“­ã§ä½¿ç”¨ã•ã‚ŒãŸéŸ³å£°ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ï¼Ÿ", "a": "é¡éŸ³ãƒªãƒ³"}, {"q": "ã„ãƒ¼ã‚ã‚‹ãµãã‚“ãã‚‰ã¶ã§ä½¿ç”¨ã•ã‚ŒãŸéŸ³å£°ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ï¼Ÿ", "a": "GUMI"}, {"q": "ãƒ‰ãƒ¼ãƒŠãƒ„ãƒ›ãƒ¼ãƒ«ã§ä½¿ç”¨ã•ã‚ŒãŸéŸ³å£°ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ï¼Ÿ", "a": "GUMI"}, {"q": "æ·±æµ·å°‘å¥³ã§ä½¿ç”¨ã•ã‚ŒãŸéŸ³å£°ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ï¼Ÿ", "a": "åˆéŸ³ãƒŸã‚¯"}, {"q": "åƒæœ¬æ¡œã§ä½¿ç”¨ã•ã‚ŒãŸéŸ³å£°ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ï¼Ÿ", "a": "åˆéŸ³ãƒŸã‚¯"}, {"q": "ãƒ–ãƒªã‚­ãƒãƒ€ãƒ³ã‚¹ã§ä½¿ç”¨ã•ã‚ŒãŸéŸ³å£°ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ï¼Ÿ", "a": "åˆéŸ³ãƒŸã‚¯"}, {"q": "å¦„æƒ³ç¨ã§ä½¿ç”¨ã•ã‚ŒãŸéŸ³å£°ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ï¼Ÿ", "a": "åˆéŸ³ãƒŸã‚¯"}, {"q": "ECHOã§ä½¿ç”¨ã•ã‚ŒãŸéŸ³å£°ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ï¼Ÿ", "a": "GUMI"}, {"q": "å¨é¢¨å ‚ã€…ã§ä½¿ç”¨ã•ã‚ŒãŸéŸ³å£°ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ï¼Ÿ", "a": "å·¡éŸ³ãƒ«ã‚«"}, {"q": "ãƒã‚³ãƒŸãƒŸã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã§ä½¿ç”¨ã•ã‚ŒãŸéŸ³å£°ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ï¼Ÿ", "a": "GUMI"}, {"q": "å¿ƒæ‹æ•°â™¯0822ã§ä½¿ç”¨ã•ã‚ŒãŸéŸ³å£°ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ï¼Ÿ", "a": "åˆéŸ³ãƒŸã‚¯"}, {"q": "glowã§ä½¿ç”¨ã•ã‚ŒãŸéŸ³å£°ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ï¼Ÿ", "a": "åˆéŸ³ãƒŸã‚¯"}, {"q": "ã‚«ã‚²ãƒ­ã‚¦ãƒ‡ã‚¤ã‚ºã§ä½¿ç”¨ã•ã‚ŒãŸéŸ³å£°ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ï¼Ÿ", "a": "IA"}, {"q": "ã‚¢ã‚¦ã‚¿ãƒ¼ã‚µã‚¤ã‚¨ãƒ³ã‚¹ã§ä½¿ç”¨ã•ã‚ŒãŸéŸ³å£°ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ï¼Ÿ", "a": "IA"}, {"q": "ã¨ã‚ã‚‹ä¸€å®¶ã®å¾¡èŒ¶ä¼šè­°ã§ä½¿ç”¨ã•ã‚ŒãŸéŸ³å£°ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ï¼Ÿ", "a": "GUMI"}, {"q": "é­”æ³•ä½¿ã„ã®å¼Ÿå­ã§ä½¿ç”¨ã•ã‚ŒãŸéŸ³å£°ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ï¼Ÿ", "a": "GUMI"}, {"q": "ãƒ¡ãƒ«ãƒˆã®æŠ•ç¨¿å¹´ã¯ï¼Ÿ", "a": "2007å¹´"}, {"q": "ç‚‰å¿ƒèè§£ã®æŠ•ç¨¿å¹´ã¯ï¼Ÿ", "a": "2008å¹´"}, {"q": "è£è¡¨ãƒ©ãƒãƒ¼ã‚ºã®æŠ•ç¨¿å¹´ã¯ï¼Ÿ", "a": "2009å¹´"}, {"q": "ãƒ¯ãƒ¼ãƒ«ã‚ºã‚¨ãƒ³ãƒ‰ãƒ»ãƒ€ãƒ³ã‚¹ãƒ›ãƒ¼ãƒ«ã®æŠ•ç¨¿å¹´ã¯ï¼Ÿ", "a": "2010å¹´"}, {"q": "ãƒãƒˆãƒªãƒ§ã‚·ã‚«ã®æŠ•ç¨¿å¹´ã¯ï¼Ÿ", "a": "2010å¹´"}, {"q": "åƒæœ¬æ¡œã®æŠ•ç¨¿å¹´ã¯ï¼Ÿ", "a": "2011å¹´"}, {"q": "ã‚«ã‚²ãƒ­ã‚¦ãƒ‡ã‚¤ã‚ºã®æŠ•ç¨¿å¹´ã¯ï¼Ÿ", "a": "2011å¹´"}, {"q": "å…­å…†å¹´ã¨ä¸€å¤œç‰©èªã®æŠ•ç¨¿å¹´ã¯ï¼Ÿ", "a": "2012å¹´"}, {"q": "è„³æ¼¿ç‚¸è£‚ã‚¬ãƒ¼ãƒ«ã®æŠ•ç¨¿å¹´ã¯ï¼Ÿ", "a": "2012å¹´"}, {"q": "ãƒ­ã‚¹ãƒˆãƒ¯ãƒ³ã®å·å“­ã®æŠ•ç¨¿å¹´ã¯ï¼Ÿ", "a": "2013å¹´"}, {"q": "ãƒ‰ãƒ¼ãƒŠãƒ„ãƒ›ãƒ¼ãƒ«ã®æŠ•ç¨¿å¹´ã¯ï¼Ÿ", "a": "2013å¹´"}, {"q": "ãƒ–ãƒªã‚­ãƒãƒ€ãƒ³ã‚¹ã®æŠ•ç¨¿å¹´ã¯ï¼Ÿ", "a": "2013å¹´"}, {"q": "é€æ˜ã‚¨ãƒ¬ã‚¸ãƒ¼ã®æŠ•ç¨¿å¹´ã¯ï¼Ÿ", "a": "2013å¹´"}, {"q": "å¦„æƒ³ç¨ã®æŠ•ç¨¿å¹´ã¯ï¼Ÿ", "a": "2014å¹´"}, {"q": "æ‹æ„›è£åˆ¤ã®æŠ•ç¨¿å¹´ã¯ï¼Ÿ", "a": "2014å¹´"}, {"q": "ELECTã®æŠ•ç¨¿å¹´ã¯ï¼Ÿ", "a": "2014å¹´"}, {"q": "ã„ãƒ¼ã‚ã‚‹ãµãã‚“ãã‚‰ã¶ã®æŠ•ç¨¿å¹´ã¯ï¼Ÿ", "a": "2012å¹´"}, {"q": "å¤©ãƒå¼±ã®æŠ•ç¨¿å¹´ã¯ï¼Ÿ", "a": "2011å¹´"}, {"q": "æ·±æµ·å°‘å¥³ã®æŠ•ç¨¿å¹´ã¯ï¼Ÿ", "a": "2010å¹´"}, {"q": "å¿ƒæ‹æ•°â™¯0822ã®æŠ•ç¨¿å¹´ã¯ï¼Ÿ", "a": "2011å¹´"}, {"q": "ãƒã‚³ãƒŸãƒŸã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã®æŠ•ç¨¿å¹´ã¯ï¼Ÿ", "a": "2011å¹´"}, {"q": "å¨é¢¨å ‚ã€…ã®æŠ•ç¨¿å¹´ã¯ï¼Ÿ", "a": "2012å¹´"}, {"q": "ã‚¤ãƒ³ãƒ“ã‚¸ãƒ–ãƒ«ã®æŠ•ç¨¿å¹´ã¯ï¼Ÿ", "a": "2011å¹´"}, {"q": "æ‚ªãƒå¨˜ã®æŠ•ç¨¿å¹´ã¯ï¼Ÿ", "a": "2008å¹´"}, {"q": "ã‚³ã‚³ãƒ­ã®æŠ•ç¨¿å¹´ã¯ï¼Ÿ", "a": "2008å¹´"}, {"q": "åˆéŸ³ãƒŸã‚¯ã®æ¶ˆå¤±ã®BPMã¯ï¼Ÿ", "a": "240"}, {"q": "ãƒ¯ãƒ¼ãƒ«ã‚ºã‚¨ãƒ³ãƒ‰ãƒ»ãƒ€ãƒ³ã‚¹ãƒ›ãƒ¼ãƒ«ã®BPMã¯ï¼Ÿ", "a": "171"}, {"q": "ãƒ­ã‚¹ãƒˆãƒ¯ãƒ³ã®å·å“­ã®BPMã¯ï¼Ÿ", "a": "162"}, {"q": "åƒæœ¬æ¡œã®BPMã¯ï¼Ÿ", "a": "154"}, {"q": "å…­å…†å¹´ã¨ä¸€å¤œç‰©èªã®BPMã¯ï¼Ÿ", "a": "186"}, {"q": "ãƒ–ãƒªã‚­ãƒãƒ€ãƒ³ã‚¹ã®BPMã¯ï¼Ÿ", "a": "210"}, {"q": "é€æ˜ã‚¨ãƒ¬ã‚¸ãƒ¼ã®BPMã¯ï¼Ÿ", "a": "190"}, {"q": "å¦„æƒ³ç¨ã®BPMã¯ï¼Ÿ", "a": "134"}, {"q": "å¤©æ¨‚ã®BPMã¯ï¼Ÿ", "a": "232"}, {"q": "è„³æ¼¿ç‚¸è£‚ã‚¬ãƒ¼ãƒ«ã®BPMã¯ï¼Ÿ", "a": "155"}, {"q": "ãƒ‰ãƒ¼ãƒŠãƒ„ãƒ›ãƒ¼ãƒ«ã®æ‹å­ã¯ï¼Ÿ", "a": "4/4"}, {"q": "æ‚ªãƒå¨˜ã®æ‹å­ã¯ï¼Ÿ", "a": "4/4"}, {"q": "ãƒ¡ãƒ«ãƒˆã®æ‹å­ã¯ï¼Ÿ", "a": "4/4"}, {"q": "glowã®æ‹å­ã¯ï¼Ÿ", "a": "4/4"}, {"q": "ECHOã®æ‹å­ã¯ï¼Ÿ", "a": "4/4"}, {"q": "ãƒ¡ãƒ«ãƒˆã¨ç‚‰å¿ƒèè§£ã§å…ˆã«æŠ•ç¨¿ã•ã‚ŒãŸã®ã¯ï¼Ÿ", "a": "ãƒ¡ãƒ«ãƒˆ"}, {"q": "åƒæœ¬æ¡œã¨å…­å…†å¹´ã¨ä¸€å¤œç‰©èªã§å…ˆã«æŠ•ç¨¿ã•ã‚ŒãŸã®ã¯ï¼Ÿ", "a": "åƒæœ¬æ¡œ"}, {"q": "ãƒ­ã‚¹ãƒˆãƒ¯ãƒ³ã®å·å“­ã¨ãƒ–ãƒªã‚­ãƒãƒ€ãƒ³ã‚¹ã§å…ˆã«æŠ•ç¨¿ã•ã‚ŒãŸã®ã¯ï¼Ÿ", "a": "ãƒ­ã‚¹ãƒˆãƒ¯ãƒ³ã®å·å“­"}, {"q": "ãƒãƒˆãƒªãƒ§ã‚·ã‚«ã¨ãƒ¯ãƒ¼ãƒ«ã‚ºã‚¨ãƒ³ãƒ‰ãƒ»ãƒ€ãƒ³ã‚¹ãƒ›ãƒ¼ãƒ«ã§å…ˆã«æŠ•ç¨¿ã•ã‚ŒãŸã®ã¯ï¼Ÿ", "a": "ãƒ¯ãƒ¼ãƒ«ã‚ºã‚¨ãƒ³ãƒ‰ãƒ»ãƒ€ãƒ³ã‚¹ãƒ›ãƒ¼ãƒ«"}, {"q": "å¦„æƒ³ç¨ã¨æ‹æ„›è£åˆ¤ã§å…ˆã«æŠ•ç¨¿ã•ã‚ŒãŸã®ã¯ï¼Ÿ", "a": "å¦„æƒ³ç¨"}, {"q": "IAã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹æ›²ã¯ã©ã‚Œã‹ï¼ˆåƒæœ¬æ¡œãƒ»ã‚«ã‚²ãƒ­ã‚¦ãƒ‡ã‚¤ã‚ºãƒ»ãƒ¡ãƒ«ãƒˆï¼‰", "a": "ã‚«ã‚²ãƒ­ã‚¦ãƒ‡ã‚¤ã‚º"}, {"q": "å·¡éŸ³ãƒ«ã‚«å˜ç‹¬æ­Œå”±ã¯ã©ã‚Œã‹ï¼ˆmagnetãƒ»Just Be Friendsãƒ»æ‚ªãƒå¨˜ï¼‰", "a": "Just Be Friends"}, {"q": "GUMIã‚’ä½¿ç”¨ã—ã¦ã„ãªã„æ›²ã¯ã©ã‚Œã‹ï¼ˆãƒ¢ã‚¶ã‚¤ã‚¯ãƒ­ãƒ¼ãƒ«ãƒ»å¤©ãƒå¼±ãƒ»åƒæœ¬æ¡œï¼‰", "a": "åƒæœ¬æ¡œ"}, {"q": "é¡éŸ³ãƒªãƒ³ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹æ›²ã¯ã©ã‚Œã‹ï¼ˆç‚‰å¿ƒèè§£ãƒ»ECHOãƒ»æ·±æµ·å°‘å¥³ï¼‰", "a": "ç‚‰å¿ƒèè§£"}, {"q": "IAã‚’ä½¿ç”¨ã—ã¦ã„ãªã„æ›²ã¯ã©ã‚Œã‹ï¼ˆå…­å…†å¹´ã¨ä¸€å¤œç‰©èªãƒ»ã‚¢ã‚¦ã‚¿ãƒ¼ã‚µã‚¤ã‚¨ãƒ³ã‚¹ãƒ»åƒæœ¬æ¡œï¼‰", "a": "åƒæœ¬æ¡œ"}, {"q": "VOCALOID3ä¸–ä»£éŸ³æºã‚’ä½¿ç”¨ã—ãŸæ›²ã¯ï¼Ÿï¼ˆå…­å…†å¹´ãƒ»ãƒ¡ãƒ«ãƒˆãƒ»æ‚ªãƒå¨˜ï¼‰", "a": "å…­å…†å¹´"}, {"q": "VOCALOID2ä¸–ä»£ã®æ›²ã¯ï¼Ÿï¼ˆãƒ¡ãƒ«ãƒˆãƒ»å¦„æƒ³ç¨ãƒ»ECHOï¼‰", "a": "ãƒ¡ãƒ«ãƒˆ"}, {"q": "V3éŸ³æºIAã‚’ä½¿ç”¨ã—ãŸæ›²ã¯ï¼Ÿ", "a": "å…­å…†å¹´ã¨ä¸€å¤œç‰©èª"}, {"q": "V2ä¸–ä»£åˆéŸ³ãƒŸã‚¯ã®æ›²ã¯ï¼Ÿ", "a": "ãƒ¡ãƒ«ãƒˆ"}, {"q": "V3ä¸–ä»£GUMIæ›²ã¯ï¼Ÿ", "a": "ãƒ‰ãƒ¼ãƒŠãƒ„ãƒ›ãƒ¼ãƒ«"}, {"q": "ãƒ¡ãƒ«ãƒˆã®ä½œæ›²è€…ã¯ï¼Ÿ", "a": "ryo"}, {"q": "ç‚‰å¿ƒèè§£ã®ä½œæ›²è€…ã¯ï¼Ÿ", "a": "iroha"}, {"q": "è£è¡¨ãƒ©ãƒãƒ¼ã‚ºã®ä½œæ›²è€…ã¯ï¼Ÿ", "a": "wowaka"}, {"q": "ãƒãƒˆãƒªãƒ§ã‚·ã‚«ã®ä½œæ›²è€…ã¯ï¼Ÿ", "a": "ãƒãƒ"}, {"q": "åƒæœ¬æ¡œã®ä½œæ›²è€…ã¯ï¼Ÿ", "a": "é»’ã†ã•P"}, {"q": "å…­å…†å¹´ã¨ä¸€å¤œç‰©èªã®ä½œæ›²è€…ã¯ï¼Ÿ", "a": "kemu"}, {"q": "ãƒ­ã‚¹ãƒˆãƒ¯ãƒ³ã®å·å“­ã®ä½œæ›²è€…ã¯ï¼Ÿ", "a": "Neru"}, {"q": "å¦„æƒ³ç¨ã®ä½œæ›²è€…ã¯ï¼Ÿ", "a": "DECO*27"}, {"q": "ãƒ–ãƒªã‚­ãƒãƒ€ãƒ³ã‚¹ã®ä½œæ›²è€…ã¯ï¼Ÿ", "a": "æ—¥å‘é›»å·¥"}, {"q": "ECHOã®ä½œæ›²è€…ã¯ï¼Ÿ", "a": "Crusher-P"}, {"q": "å¤©ãƒå¼±ã®ä½œæ›²è€…ã¯ï¼Ÿ", "a": "164"}, {"q": "ã„ãƒ¼ã‚ã‚‹ãµãã‚“ãã‚‰ã¶ã®ä½œæ›²è€…ã¯ï¼Ÿ", "a": "ã¿ãã¨P"}, {"q": "ãƒã‚³ãƒŸãƒŸã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã®ä½œæ›²è€…ã¯ï¼Ÿ", "a": "ç³ç”°èˆP"}, {"q": "glowã®ä½œæ›²è€…ã¯ï¼Ÿ", "a": "keeno"}, {"q": "å¿ƒæ‹æ•°â™¯0822ã®ä½œæ›²è€…ã¯ï¼Ÿ", "a": "è¶ã€…P"}, {"q": "ã‚«ã‚²ãƒ­ã‚¦ãƒ‡ã‚¤ã‚ºã®ä½œæ›²è€…ã¯ï¼Ÿ", "a": "ã˜ã‚“"}, {"q": "ã‚¤ãƒ³ãƒ“ã‚¸ãƒ–ãƒ«ã®ä½œæ›²è€…ã¯ï¼Ÿ", "a": "kemu"}, {"q": "æ‚ªãƒå¨˜ã®ä½œæ›²è€…ã¯ï¼Ÿ", "a": "mothy"}, {"q": "ã¨ã‚ã‚‹ä¸€å®¶ã®å¾¡èŒ¶ä¼šè­°ã®ä½œæ›²è€…ã¯ï¼Ÿ", "a": "ãã‚‹ã‚Šã‚“ã”"}, {"q": "é­”æ³•ä½¿ã„ã®å¼Ÿå­ã®ä½œæ›²è€…ã¯ï¼Ÿ", "a": "ãã‚‹ã‚Šã‚“ã”"}]};

// éš ã—è¨­å®šï¼ˆUIã‹ã‚‰çœã„ãŸã‚‚ã®ï¼‰
const gapQ = { value: 0.5 };
const gapAfterA = { value: 0.5 };
const pitch = { value: 1 };


let items = [];
let idx = -1;
let playing = false;
let paused = false;
let playSessionId = 0;
let currentTimeout = null;
let revealAnswerForCurrent = false;
let revealedAnswerIdxSet = new Set();

const elements = {
  clearBtn: document.getElementById('clearBtn'),  startBtn: document.getElementById('startBtn'),
  pauseBtn: document.getElementById('pauseBtn'),
  stopBtn: document.getElementById('stopBtn'),
  prevBtn: document.getElementById('prevBtn'),
  nextBtn: document.getElementById('nextBtn'),
  prog: document.getElementById('prog'),
  status: document.getElementById('status'),
  topImportFile: document.getElementById('topImportFile'),
  repeatQ: document.getElementById('repeatQ'),
  delayA: document.getElementById('delayA'),
  vol: document.getElementById('vol'),
  rate: document.getElementById('rate'),
  voiceSel: document.getElementById('voice'),
  langHint: document.getElementById('langHint'),
  showAnswerSel: document.getElementById('showAnswer'),
  list: document.getElementById('list'),
  errorMsg: document.getElementById('errorMsg'),
  successMsg: document.getElementById('successMsg')
};

function updateStatus(msg) { elements.status.textContent = msg; }
function updateProgress() { elements.prog.value = (idx >= 0 && items.length) ? (idx + 1) / items.length : 0; }
function showError(m) { elements.errorMsg.textContent = m; elements.errorMsg.style.display='block'; setTimeout(()=>elements.errorMsg.style.display='none', 5000); }
function showSuccess(m) { elements.successMsg.textContent = m; elements.successMsg.style.display='block'; setTimeout(()=>elements.successMsg.style.display='none', 3000); }

function loadVoices() {
  const voices = speechSynthesis.getVoices();
  const hint = elements.langHint.value;
  elements.voiceSel.innerHTML = '';
  const filtered = voices.filter(v => v.lang.startsWith(hint.substring(0, 2)));
  (filtered.length ? filtered : voices).forEach(v => {
    const opt = document.createElement('option');
    opt.value = v.name; opt.textContent = `${v.name} (${v.lang})`;
    elements.voiceSel.appendChild(opt);
  });
}
speechSynthesis.addEventListener('voiceschanged', loadVoices);
elements.langHint.addEventListener('change', loadVoices);

function hardStop() {
  playSessionId++;
  speechSynthesis.cancel();
  if (currentTimeout) { clearTimeout(currentTimeout); currentTimeout = null; }
  revealAnswerForCurrent = false;
}

async function speakText(text, sessionAtStart) {
  return new Promise(resolve => {
    if (sessionAtStart !== playSessionId || !playing) return resolve();
    const u = new SpeechSynthesisUtterance(String(text || ''));
    const voices = speechSynthesis.getVoices();
    u.voice = voices.find(v => v.name === elements.voiceSel.value) || null;
    u.volume = parseFloat(elements.vol.value);
    u.rate = parseFloat(elements.rate.value);
    u.lang = elements.langHint.value;
    u.onend = resolve;
    u.onerror = resolve;
    speechSynthesis.speak(u);
  });
}

function sleep(ms) {
  return new Promise(resolve => { currentTimeout = setTimeout(() => { currentTimeout = null; resolve(); }, ms); });
}

function renderList() {
  elements.list.innerHTML = '';
  const alwaysShow = elements.showAnswerSel.value === '1';
  items.forEach((it, i) => {
    const row = document.createElement('div');
    row.className = `item ${i === idx ? 'active' : ''}`;
    row.dataset.idx = i;

    const content = document.createElement('div');
    const qDiv = document.createElement('div'); qDiv.className = 'q'; qDiv.textContent = `#${i+1} ${it.q}`;
    content.appendChild(qDiv);

    if (alwaysShow || revealedAnswerIdxSet.has(i) || (playing && i === idx && revealAnswerForCurrent)) {
      const aDiv = document.createElement('div'); aDiv.className = 'a'; aDiv.textContent = `â–¸ ${it.a}`;
      content.appendChild(aDiv);
    }
    row.appendChild(content);
    elements.list.appendChild(row);
  });
}

async function playLoop(sessionAtStart) {
  while (sessionAtStart === playSessionId && playing) {
    if (idx < 0 || idx >= items.length) {
      playing = false; updateStatus('Discovery Complete'); renderList(); return;
    }
    const it = items[idx];
    revealAnswerForCurrent = false;
    renderList();
    updateProgress();
    elements.list.children[idx]?.scrollIntoView({behavior:'smooth', block:'center'});
    updateStatus(`Exploring #${idx + 1}...`);

    for (let r = 0; r < parseInt(elements.repeatQ.value); r++) {
      if (sessionAtStart !== playSessionId) return;
      await speakText(it.q, sessionAtStart);
      await sleep(500);
    }

    await sleep(parseFloat(elements.delayA.value) * 1000);
    if (sessionAtStart !== playSessionId) return;

    revealAnswerForCurrent = true;
    revealedAnswerIdxSet.add(idx);
    renderList();

    await speakText(it.a, sessionAtStart);
    await sleep(500);

    idx++;
    if (idx >= items.length) { playing = false; updateStatus('Voyage End'); renderList(); return; }
  }
}


// ç›´æ¥å…¥åŠ›ã‹ã‚‰èª­è¾¼
document.getElementById('loadDirectBtn').onclick = () => {
  const raw = document.getElementById('directInput').value.trim();
  if (!raw) { showError('ãƒ†ã‚­ã‚¹ãƒˆãŒå…¥åŠ›ã•ã‚Œã¦ã„ã¾ã›ã‚“'); return; }
  const lines = raw.split('\n').map(l => l.trim()).filter(Boolean);
  const parsed = [];
  for (const line of lines) {
    const sep = line.includes('\t') ? '\t' : '|';
    const parts = line.split(sep);
    if (parts.length >= 2) {
      const q = parts[0].trim();
      const a = parts.slice(1).join(sep).trim();
      if (q && a) parsed.push({ q, a });
    }
  }
  if (!parsed.length) { showError('æœ‰åŠ¹ãªQ&AãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚ã€Œè³ªå•|ç­”ãˆã€å½¢å¼ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚'); return; }
  loadDataFromJSON({ version: 1, items: parsed });
  showSuccess(`${parsed.length}å• èª­ã¿è¾¼ã¿ã¾ã—ãŸï¼`);
};
elements.startBtn.onclick = () => { if(!items.length) return; hardStop(); idx=0; playing=true; startNoteLoop(); playLoop(playSessionId); };
elements.pauseBtn.onclick = () => {
  if (paused) { hardStop(); playing=true; paused=false; startNoteLoop(); playLoop(playSessionId); }
  else if (playing) { hardStop(); playing=false; paused=true; startNoteLoop(); updateStatus('Paused'); renderList(); }
};
elements.stopBtn.onclick = () => { hardStop(); playing=false; paused=false; idx=-1; renderList(); updateProgress(); updateStatus('Stopped'); startNoteLoop(); };
elements.nextBtn.onclick = () => { if(!items.length) return; hardStop(); idx=Math.min(items.length-1, idx+1); playing=true; startNoteLoop(); playLoop(playSessionId); };
elements.prevBtn.onclick = () => { if(!items.length) return; hardStop(); idx=Math.max(0, idx-1); playing=true; startNoteLoop(); playLoop(playSessionId); };

elements.list.onclick = (e) => {
  const row = e.target.closest('.item');
  if(!row) return;
  hardStop(); idx = parseInt(row.dataset.idx); playing=true; startNoteLoop(); playLoop(playSessionId);
};

function loadDataFromJSON(data) {
  hardStop();
  items = data.items || [];
  revealedAnswerIdxSet = new Set();
  idx = items.length ? 0 : -1;
  renderList();
  updateProgress();
  loadVoices();
  startNoteLoop();
}

elements.topImportFile.onchange = (e) => {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = () => {
    const content = reader.result;
    if (file.name.endsWith('.txt') || file.type === 'text/plain') {
      // ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ï¼šè³ªå•|ç­”ãˆ å½¢å¼ã§è§£æ
      const lines = content.split('\n').map(l => l.trim()).filter(Boolean);
      const parsed = [];
      for (const line of lines) {
        const sep = line.includes('\t') ? '\t' : '|';
        const parts = line.split(sep);
        if (parts.length >= 2) {
          const q = parts[0].trim();
          const a = parts.slice(1).join(sep).trim();
          if (q && a) parsed.push({ q, a });
        }
      }
      if (!parsed.length) { showError('æœ‰åŠ¹ãªQ&AãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚ã€Œè³ªå•|ç­”ãˆã€å½¢å¼ã§è¨˜è¿°ã—ã¦ãã ã•ã„ã€‚'); return; }
      loadDataFromJSON({ version: 1, items: parsed });
      showSuccess(`${parsed.length}å• èª­ã¿è¾¼ã¿ã¾ã—ãŸï¼`);
    } else {
      // JSONãƒ•ã‚¡ã‚¤ãƒ«
      try {
        loadDataFromJSON(JSON.parse(content));
        showSuccess('JSON Loaded');
      } catch {
        showError('JSONã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
      }
    }
  };
  reader.readAsText(file);
};

/* =========================
   èµ·å‹•æ™‚ï¼šåŸ‹ã‚è¾¼ã¿ãƒœã‚«ãƒ­ã‚¯ã‚¤ã‚º100ã‚’è‡ªå‹•ãƒ­ãƒ¼ãƒ‰
   ========================= */
window.addEventListener('DOMContentLoaded', () => {
  try {
    loadDataFromJSON(EMBEDDED_DATA);
    showSuccess(`Vocaloid Quiz Loaded (${(EMBEDDED_DATA.items||[]).length}å•)`);
    updateStatus('Ready (Vocaloid embedded)');
  } catch (e) {
    showError('åŸ‹ã‚è¾¼ã¿ãƒ‡ãƒ¼ã‚¿ã®èª­è¾¼ã«å¤±æ•—ã—ã¾ã—ãŸ');
    updateStatus('Ready');
  }
});

window.addEventListener('keydown', (e) => {
  if (['INPUT','SELECT'].includes(document.activeElement.tagName)) return;
  if (e.code === 'Space') { e.preventDefault(); elements.pauseBtn.click(); }
  if (e.key === 'ArrowRight') elements.nextBtn.click();
  if (e.key === 'ArrowLeft') elements.prevBtn.click();
});

/* =========================
   èƒŒæ™¯ï¼šãƒ©ã‚¤ãƒ ã‚°ãƒªãƒ¼ãƒ³éŸ³ç¬¦
   ========================= */
const bgNotesEl = document.getElementById('bg-notes');
const noteSymbols = ['â™ª', 'â™«', 'â™¬', 'â™©'];

function createFloatingNote() {
  const note = document.createElement('div');
  note.className = 'floating-note';
  note.textContent = noteSymbols[(Math.random() * noteSymbols.length) | 0];

  const x = Math.random() * window.innerWidth;
  note.style.left = `${x}px`;

  const duration = 5 + Math.random() * 5;          // 5ã€œ10ç§’
  const size = 12 + Math.random() * 18;            // 12ã€œ30px
  const drift = (Math.random() * 120 - 60).toFixed(0) + 'px'; // æ¨ªæºã‚Œ
  note.style.fontSize = `${size}px`;
  note.style.animationDuration = `${duration}s`;
  note.style.opacity = (0.25 + Math.random() * 0.55).toFixed(2);
  note.style.setProperty('--drift', drift);

  bgNotesEl.appendChild(note);

  setTimeout(() => note.remove(), duration * 1000);
}

/* =========================
   èƒŒæ™¯éŸ³ç¬¦ï¼šçŠ¶æ³ä¾å­˜ã®å‡ºç¾é–“éš”ï¼ˆå†ç”Ÿä¸­ã ã‘å°‘ã—æ¸›ã‚‰ã™ï¼‰
   ========================= */
let noteTimer = null;

function startNoteLoop() {
  if (noteTimer) clearInterval(noteTimer);

  // å†ç”Ÿä¸­ã¯å°‘ã—ã ã‘æ§ãˆã‚ï¼ˆé‚ªé­”ã—ãªã„ï¼‰
  const interval = playing ? 700 : 520;

  noteTimer = setInterval(createFloatingNote, interval);
}

// åˆæœŸçŠ¶æ…‹ï¼ˆåœæ­¢ä¸­ï¼‰
startNoteLoop();

loadVoices();
</script>
</body>
</html>
